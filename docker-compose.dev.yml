version: '3.4'
services:
 backend:
  build:
   context: .
   target: modules
  image: cloudhost/backend_development:latest
  command: npm run dev
  labels:
   - 'traefik.enable=true'
   - 'traefik.backend=cloudhost-API'
   - 'traefik.docker.network=traefik'
   - 'traefik.frontend.rule=Host:api.localhost'
   - 'traefik.port=3000'
  volumes:
   - /var/run/docker.sock:/var/run/docker.sock:ro
   - .:/usr/app/backend/
   - /usr/app/frontend/node_modules
  tty: true
  env_file:
   - .env.development
  networks:
   - app
   - users
   - traefik
  depends_on:
   - mysql


networks:
  traefik:
    external: true